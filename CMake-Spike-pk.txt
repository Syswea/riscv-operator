cmake_minimum_required(VERSION 3.10)

# 项目名称
project(RISCV_RVV_Project C CXX)

# --- 1. 工具链路径配置 ---
# 指向你安装工具链的具体位置
set(RISCV_TOOLCHAIN_ROOT "/home/syswea/Workspace/tools-for-riscv/toolchain-spike")
set(RISCV_SYSROOT "${RISCV_TOOLCHAIN_ROOT}/sysroot")

# --- 2. 编译器设置 ---
# Clang 是多目标编译器，必须通过 --target 指定目标三元组
set(TARGET_TRIPLE "riscv64-unknown-linux-gnu")

set(CMAKE_C_COMPILER "${RISCV_TOOLCHAIN_ROOT}/bin/clang")
set(CMAKE_CXX_COMPILER "${RISCV_TOOLCHAIN_ROOT}/bin/clang++")

# --- 3. 编译选项 (包含 RVV 支持) ---
# -march: rv64gcv 包含了 Vector (v) 扩展
# --sysroot: 让 Clang 找到 Linux 的头文件和库文件
set(COMMON_FLAGS "--target=${TARGET_TRIPLE} --sysroot=${RISCV_SYSROOT} -march=rv64gcv -mabi=lp64d")

set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} ${COMMON_FLAGS} -Wall")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${COMMON_FLAGS} -stdlib=libc++ -Wall")

# 如果你在使用 pk 运行，建议使用静态链接以减少动态库缺失问题
set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -static")

# --- 4. 源码管理 ---
# 包含 src_rvv 文件夹下的所有头文件
include_directories(src_rvv)

# 获取 src_rvv 目录下的所有源文件
file(GLOB_RECURSE SOURCES "src_rvv/*.c" "src_rvv/*.cpp")

# --- 5. 生成可执行文件 ---
add_executable(rvv_app ${SOURCES})

# 打印信息用于调试
message(STATUS "Using RISC-V Sysroot: ${RISCV_SYSROOT}")
message(STATUS "Target: ${TARGET_TRIPLE}")